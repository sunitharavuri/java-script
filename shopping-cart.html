<!DOCTYPE html>
<html>

<head>
	<title>Shopping-Cart</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>

<body>

	<h3>Shopping Cart</h3>
	<div>
		<ul>
			<li><a class="add-to-cart" href="#" data-name="apple" data-price="1.22">Apple $1.22</a></li>
			<li><a class="add-to-cart" href="#" data-name="mango" data-price="2.20">Mango $2.20</a></li>
			<li><a class="add-to-cart" href="#" data-name="banana" data-price="2">Banana $2</a></li>
		</ul>
		<button id="clear-cart">Clear Cart</button>
	</div>
	<div>
		<ul id="show-cart">
			<!---   -->
		</ul>
		<div>
			Total Price:$<span id="total-cart"></span>
		</div>
	</div>



	<script type="text/javascript">
		$(".add-to-cart").click(function (event) {
			event.preventDefault();
			var name = $(this).attr("data-name");
			var price = Number($(this).attr("data-price"));

			addItemToCart(name, price, 1);
			displayCart();
		});

		function displayCart() {
			var cartArray = listCart();
			var output = "";
			for (var i in cartArray) {
				output += "<li>" + cartArray[i].name + "<input  class='item-count' type='number' step=1 data-name='" + cartArray[i]
					.name + "' value='" + cartArray[i].count + "'/> " + cartArray[i].count +
					"*" + cartArray[i].price + " =" + cartArray[i].total +
					"<button class='delete-cart' data-name='" + cartArray[i].name + "'>X</button>" +
					"<button class='minus-cart' data-name='" + cartArray[i].name + "'></button>" +
					"<button class='minus-cart' data-name='" + cartArray[i].name + "'>-</button>" +
					"<button class='minus-cart' data-name='" + cartArray[i].name + "'></button>" +
					"<button class='plus-cart' data-name='" + cartArray[i].name + "'>+</button>" + "</li>"
			}
			$("#show-cart").html(output);
			$("#total-cart").html(totalCart());
		};
		$("#clear-cart").click(function (event) {
			clearCart();
			displayCart();
		});
		$("#show-cart").on("click", ".delete-cart", function (event) {
			var name = $(this).attr("data-name");
			removeAllItems(name);
			displayCart();
		});
		$("#show-cart").on("click", ".minus-cart", function (event) {
			var name = $(this).attr("data-name");
			removeItemFromCart(name)
			displayCart();
		});
		$("#show-cart").on("click", ".plus-cart", function (event) {
			var name = $(this).attr("data-name");
			addItemToCart(name, 0, 1)
			displayCart();
		});
		$("#show-cart").on("change", ".item-count", function (event) {
			var name = $(this).attr("data-name");
			var count = Number($(this).val());
			setCountItem(name, count);
			displayCart();
		})




		// ***************************
		// javascript functions
		//var shoppingCart=(function(){})();
		var cart = [];

		var Item = function (name, price, count) {
			this.name = name
			this.price = price
			this.count = count
		};

		function addItemToCart(name, price, count) {
			for (var i in cart) {
				if (cart[i].name === name) {
					cart[i].count += count;

					saveCart();
					return;
				}
			}
			var item = new Item(name, price, count);
			cart.push(item);
			saveCart();
		}



		function removeItemFromCart(name) {
			for (var i in cart) {
				if (cart[i].name === name) {
					cart[i].count--; //cart[i].count=cart[i].count-1;
					if (cart[i].count === 0) {
						cart.splice(i, 1);

					}
					break;
				}
			}
			saveCart();
		}

		function removeAllItems(name) {
			for (var i in cart) {
				if (cart[i].name === name) {
					cart.splice(i, 1);
					break;
				}

			}
			saveCart();
		}



		console.log(cart.length);
		console.log(cart);


		function clearCart() {
			cart = [];
			saveCart();
		}

		function countCart() { //return total count
			var totalCount = 0;
			for (var i in cart) {
				totalCount += cart[i].count;
			}
			return totalCount;
		}


		function totalCart() {
			var totalCost = 0;
			for (var i in cart) {
				totalCost += cart[i].count * cart[i].price;
			}

			return totalCost.toFixed(2);
		}

		function setCountItem(name, count) {
			for (var i in cart) {
				if (cart[i].name === name)
					cart[i].count = count;
				break;
			}
			saveCart();
		};

		function listCart() {
			var cartCopy = []; //empty array
			for (var i in cart) { // iterating in total cart 
				var item = cart[i]; //assigning iterated items to 'item' variable
				var itemCopy = {}; //empty object
				for (var p in item) { // iterating  among properties of item and assigning to a variable
					itemCopy[p] = item[p];
				}
				itemCopy.total = (item.count * item.price).toFixed(2);
				cartCopy.push(itemCopy);
			}
			return cartCopy;
		}


		function saveCart() {
			localStorage.setItem("shoppingCart", JSON.stringify(cart));
		}

		function loadCart() {
			cart = JSON.parse(localStorage.getItem("shoppingCart"));

		}
		loadCart();
		displayCart();
	</script>

</body>

</html>